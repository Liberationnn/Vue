{"version":3,"sources":["webpack:///src/components/List.vue","webpack:///./src/components/List.vue?2d28","webpack:///./src/components/List.vue"],"names":["List","name","data","books","book","hasMore","isLoading","timer","isRemoving","created","this","doGetBooks","mounted","_this","content","$refs","startTop","offsetTop","ontouchstart","e","start","touches","pageY","ontouchmove","scrollTop","offset","style","top","ontouchend","setTimeout","length","doInitBooks","setInterval","parseInt","clearInterval","methods","doGetAllBooks","_this2","asyncToGenerator_default","regenerator_default","a","mark","_callee","wrap","_context","prev","next","Object","api","sent","stop","_this3","_callee2","_ref","_context2","doGetMoreBooks","_this4","_callee3","_ref2","_context3","doGetBook","id","_this5","_callee4","_context4","doAddBook","_this6","_callee5","_context5","doUpdateBook","_this7","_callee6","_context6","doRemoveBook","_this8","_callee7","temp","_context7","filter","item","reverse","slice","$store","commit","mutations_types","_this9","_callee8","_context8","loadMore","_this10","clearTimeout","_$refs$content","clientHeight","scrollHeight","addCar","components","MHeader","components_List","render","_vm","_h","$createElement","_c","_self","_v","ref","staticClass","on","scroll","_l","index","key","bookCover","attrs","to","params","tag","directives","rawName","value","expression","alt","_s","bookName","bookInfo","bookPrice","click","$event","stopPropagation","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/6.2c068fffb50622e6afed.js","sourcesContent":["<template>\n  <div>\n    <MHeader>列表页</MHeader>\n    <div class=\"content\" ref=\"content\" @scroll=\"loadMore\">\n      <div class=\"text-center tip\" v-if=\"!books.length\">下拉获取数据</div>\n      <ul v-else>\n        <router-link :to=\"{name:'detail',params:{id:book.id}}\" class=\"list-group-item clearfix\" tag=\"li\"\n                     v-for=\"(book, index) in books\" :key=\"book.bookCover+index\">\n          <img v-lazy=\"book.bookCover\" alt=\"\">\n          <div class=\"wrap\">\n            <h4>{{book.bookName}}</h4>\n            <p>{{book.bookInfo}}</p>\n            <span>￥ {{book.bookPrice}}</span>\n            <div>\n              <button class=\"btn btn-danger btn-sm\" @click.stop=\"addCar(book)\">加入购物车</button>\n              <button class=\"btn btn-danger btn-sm\" @click.stop=\"doRemoveBook(book)\">删除</button>\n            </div>\n          </div>\n        </router-link>\n      </ul>\n    </div>\n  </div>\n</template>\n\n<script>\n  import MHeader from '../base/MHeader';\n  import {getAllBooks, getMoreBooks, getBook, addBook, updateBook, removeBook, initBooks} from \"../api\";\n  import * as Types from '../store/mutations-types';\n\n  export default {\n    name: \"List\",\n    data() {\n      return {\n        books: [],\n        book: {},\n        hasMore: true,\n        isLoading: false,\n        timer: null,\n        isRemoving: false,\n      };\n    },\n    created() {\n      this.doGetBooks();\n    },\n    mounted() {\n      let content = this.$refs.content;\n      let startTop = content.offsetTop;\n      content.ontouchstart = (e) => {\n        let start = e.touches[0].pageY;\n        content.ontouchmove = (e) => {\n          if (content.scrollTop === 0) {\n            let offset = e.touches[0].pageY - start;\n            if (offset > 0) {\n              if (offset < 50) {\n                content.style.top = startTop + offset + 'px';\n              } else {\n                content.style.top = startTop + 50 + 'px';\n              }\n            }\n            content.ontouchend = (e) => {\n              if (offset >= 50) {\n                this.doGetBooks();\n                setTimeout(() => {\n                  if (this.books.length === 0) {\n                    this.doInitBooks();\n                  }\n                }, 200);\n              }\n              let timer = setInterval(() => {\n                if (parseInt(content.style.top) <= startTop) {\n                  clearInterval(timer);\n                } else {\n                  content.style.top = parseInt(content.style.top) - 1 + 'px';\n                }\n              }, 1);\n              content.ontouchmove = content.ontouchend = null;\n            };\n          }\n        };\n      };\n    },\n    methods: {\n      async doGetAllBooks() {\n        this.books = await getAllBooks();\n      },\n      async doGetBooks() { // 进入list页面时，显示6条数据\n        let {books, hasMore} = await getMoreBooks(6);\n        this.books = []; // 先清空books再赋值，以触发懒加载效果\n        this.books = books;\n        this.hasMore = hasMore;\n      },\n      async doGetMoreBooks() { // 获取更多数据(3条)\n        if (this.hasMore && !this.isLoading) {\n          this.isLoading = true;\n          let {books, hasMore} = await getMoreBooks(this.books.length + 3);\n          this.books = books;\n          this.hasMore = hasMore;\n          this.isLoading = false;\n        }\n      },\n      async doGetBook(id) {\n        this.book = await getBook(id);\n      },\n      async doAddBook(book) {\n        await addBook(book);\n        this.doGetBooks();\n      },\n      async doUpdateBook(book) {\n        await updateBook(book);\n        this.doGetBooks();\n      },\n      async doRemoveBook(book) {\n        if (!this.isRemoving) {\n          this.books = this.books.filter((item) => item.id !== book.id);\n          this.isRemoving = true;\n          let temp = await removeBook(book.id);\n          this.books = temp.reverse().slice(0, this.books.length);\n          this.$store.commit(Types.REMOVE, book);\n          this.isRemoving = false;\n        }\n      },\n      async doInitBooks() {\n        this.books = await initBooks();\n      },\n      loadMore() {\n        clearTimeout(this.timer);\n        this.timer = setTimeout(() => {\n          let {clientHeight, scrollTop, scrollHeight} = this.$refs.content;\n          if (clientHeight + scrollTop + 20 >= scrollHeight) {\n            this.doGetMoreBooks();\n          }\n        }, 10);\n      },\n      addCar(book) {\n        this.$store.commit(Types.ADD, book);\n      },\n    },\n    components: {MHeader}\n  }\n</script>\n\n<style scoped lang=\"less\">\n  .tip {\n    margin-top: 14px;\n    font-size: 16px;\n  }\n  ul {\n    margin-bottom: 0;\n    li {\n      display: flex;\n      justify-content: center;\n      height: 166px;\n      img {\n        width: 50%;\n      }\n      .wrap {\n        position: relative;\n        width: 50%;\n        div {\n          position: absolute;\n          bottom: 4px;\n          right: 0;\n        }\n      }\n    }\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/List.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('MHeader',[_vm._v(\"列表页\")]),_vm._v(\" \"),_c('div',{ref:\"content\",staticClass:\"content\",on:{\"scroll\":_vm.loadMore}},[(!_vm.books.length)?_c('div',{staticClass:\"text-center tip\"},[_vm._v(\"下拉获取数据\")]):_c('ul',_vm._l((_vm.books),function(book,index){return _c('router-link',{key:book.bookCover+index,staticClass:\"list-group-item clearfix\",attrs:{\"to\":{name:'detail',params:{id:book.id}},\"tag\":\"li\"}},[_c('img',{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:(book.bookCover),expression:\"book.bookCover\"}],attrs:{\"alt\":\"\"}}),_vm._v(\" \"),_c('div',{staticClass:\"wrap\"},[_c('h4',[_vm._v(_vm._s(book.bookName))]),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(book.bookInfo))]),_vm._v(\" \"),_c('span',[_vm._v(\"￥ \"+_vm._s(book.bookPrice))]),_vm._v(\" \"),_c('div',[_c('button',{staticClass:\"btn btn-danger btn-sm\",on:{\"click\":function($event){$event.stopPropagation();_vm.addCar(book)}}},[_vm._v(\"加入购物车\")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-danger btn-sm\",on:{\"click\":function($event){$event.stopPropagation();_vm.doRemoveBook(book)}}},[_vm._v(\"删除\")])])])])}))])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-0b07d72f\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/List.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-0b07d72f\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./List.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./List.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./List.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-0b07d72f\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./List.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-0b07d72f\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/List.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}